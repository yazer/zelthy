{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Zelthy Challenge</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="{% static 'dist/echarts.min.js' %}"></script>
</head>
<body onload="drawEchart();">
    <div style="margin-left: 482px; margin-top: 25px;">
        <label for="year_filter">Date Filter</label>
        <select id="id_year_filter" name="year_filter" onchange="updateChart(this)">
            <option value="2010">2010</option>
            <option value="2011">2011</option>
            <option value="2012">2012</option>
            <option value="2013">2013</option>
            <option value="2014">2014</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>
            <option value="2020" selected>2020</option>
        </select>
    </div>
    <div id="main" style="width: 600px;height:400px;"></div>
</body>
<script type="text/javascript">
    var upadate_url = "{% url 'updatepurchasechart' %}"
    var month_data = JSON.parse("{{month_data}}");
    function drawEchart(){
        var myChart = echarts.init(document.getElementById('main'));

        var option = {
            title: {
                text: 'Purchase Bar Chart'
            },
            tooltip: {},
            legend: {
                data:['Sales']
            },
            xAxis: {
                data: ["Jan" ,"Feb" , "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
            },
            yAxis: {},
            series: [{
                name: 'Sales',
                type: 'bar',
                data: month_data
            }]
        };

        myChart.setOption(option);
    }
    
    function updateChart(el){
        $.ajax({
            url: upadate_url,
            method: 'POST',
            data: {'year': $('#id_year_filter').val()},
            success:function(data){
                if(data.code == "1"){
                    month_data = data.response.month_data;
                    drawEchart();
                }else{
                    console.log(data.msg)
                }
            }
        })
    }
</script>
</html>